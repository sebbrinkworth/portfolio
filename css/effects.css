/* ============================================
   VIEW TRANSITIONS API - Cross-Document
   ============================================ */

/* Base transition settings */
@view-transition {
  navigation: auto;
}

::view-transition-group(root) {
  animation-timing-function: var(--expo-out);
  animation-duration: 400ms;
}

/* Old page (exiting) animation */
::view-transition-old(root) {
  animation: vt-slide-out 400ms var(--expo-out) forwards;
}

/* New page (entering) animation */
::view-transition-new(root) {
  animation: vt-slide-in 400ms var(--expo-out) forwards;
}

@keyframes vt-slide-out {
  from {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateX(-30px) scale(0.98);
  }
}

@keyframes vt-slide-in {
  from {
    opacity: 0;
    transform: translateX(30px) scale(1.02);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

/* ============================================
   VIEW TRANSITIONS API - Theme Toggle
   ============================================ */

/* Theme switch animation */
html.view-transition-theme::view-transition-new(root) {
  mask: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><circle cx="20" cy="20" r="20" fill="white"/></svg>') center / 0 no-repeat;
  animation: vt-theme-scale 1s;
  animation-fill-mode: both;
}

@keyframes vt-theme-scale {
  to {
    mask-size: 200vmax;
  }
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-group(root) {
    animation-duration: 0ms;
  }
}

/* Background: vector-field container (masked around cursor) */
#field-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
  transform: translateZ(0);

  --cx: 50vw;
  --cy: 50vh;

  -webkit-mask-image: radial-gradient(circle var(--field-mask-radius) at var(--cx) var(--cy),
      rgba(0, 0, 0, 1),
      rgba(0, 0, 0, 0));
  mask-image: radial-gradient(circle var(--field-mask-radius) at var(--cx) var(--cy),
      rgba(0, 0, 0, 1),
      rgba(0, 0, 0, 0));
}

#field-grid {
  position: absolute;
  inset: calc(-1 * var(--field-overscan));
  display: grid;
  place-items: center;
}

.dash {
  width: 16px;
  height: 2px;
  border-radius: 999px;
  transform-origin: 50% 50%;
  will-change: transform, opacity;
  background: rgb(var(--fg) / 0.3);
  opacity: 0.1;
}

html.dark .dash {
  background: rgb(255 255 255 / 0.2);
}

/* Grain overlay */
.grain {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 50;
  background-image: url("data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%220.03%22/%3E%3C/svg%3E");
}

.grain-light {
  opacity: 0.55;
  mix-blend-mode: multiply;
}

html.dark .grain-light {
  opacity: 0;
}

.grain-dark {
  opacity: 0;
  mix-blend-mode: overlay;
}

html.dark .grain-dark {
  opacity: 0.6;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  #field-bg {
    display: none;
  }
}